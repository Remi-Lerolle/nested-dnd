{"ast":null,"code":"var _jsxFileName = \"/home/remi/REACT/nested-dnd/src/Widget.js\",\n  _s = $RefreshSig$();\nimport React, { Children, useState } from \"react\";\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { removeWidget, updateWidgetListOfDescendant, removeWidgetInGrid } from \"./widgetSlice\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const WidgetToDrag = ({\n  widgetKey,\n  index,\n  indexInGrid = null\n}) => {\n  _s();\n  const listOfWidgets = useSelector(state => state.listOfWidgets.value);\n  const dispatch = useDispatch();\n  let thisWidgetObj;\n  if (index === null) {\n    // comes from sidebar read it from props\n    thisWidgetObj = {\n      type: ItemTypes[widgetKey],\n      clientOffset: {\n        x: 0,\n        y: 0\n      },\n      sideBar: true\n    };\n  } else if (indexInGrid !== null) {\n    // comes from pagelayout read it from the state\n    thisWidgetObj = {\n      ...listOfWidgets[index].children[indexInGrid],\n      sideBar: false\n    };\n  } else {\n    thisWidgetObj = {\n      ...listOfWidgets[index],\n      sideBar: false\n    };\n  }\n  const [dragCollected, drag] = useDrag(() => ({\n    type: thisWidgetObj.type,\n    item: {\n      itemType: thisWidgetObj.type,\n      addOrUpdatePos: thisWidgetObj.sideBar ? \"add\" : index\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging()\n    }),\n    previewOptions: {\n      backgroundColor: \"red\"\n    }\n  }));\n  const [dropCollected, drop] = useDrop(() => ({\n    accept: [ItemTypes.SIMPLEWIDGET],\n    drop(_item, monitor) {\n      console.log(\"drop\");\n      handleDrop({\n        type: monitor.getItem().itemType\n      });\n    },\n    collect: monitor => ({\n      isOver: monitor.isOver()\n    })\n  }));\n  let bgColor;\n  if (thisWidgetObj.type.includes(\"simple\")) {\n    bgColor = \"grey\";\n  } else if (thisWidgetObj.type === \"gridwidget\") {\n    bgColor = \"lightblue\";\n  } else if (dropCollected.isOver) {\n    bgColor = \"red\";\n  } else {\n    bgColor = \"lightblue\";\n  }\n  const style = {\n    padding: \"15px\",\n    backgroundColor: bgColor,\n    border: dragCollected.isDragging ? \"1px solid blue\" : \"1px solid red\",\n    opacity: dragCollected.isDragging ? \"0.5\" : \"1\",\n    margin: \"5px\",\n    width: \"fit-content\",\n    position: thisWidgetObj.sideBar || indexInGrid !== null ? \"relative\" : \"absolute\",\n    top: indexInGrid === null ? thisWidgetObj.clientOffset.y : \"0px\",\n    left: indexInGrid === null ? thisWidgetObj.clientOffset.x : \"0px\"\n  };\n  const handleDrop = obj => {\n    dispatch(updateWidgetListOfDescendant({\n      index,\n      newDescendant: obj\n    }));\n  };\n  const handleRemove = (index, indexInGrid) => {\n    if (indexInGrid !== null) {\n      dispatch(removeWidgetInGrid({\n        index,\n        indexInGrid\n      }));\n    } else {\n      dispatch(removeWidget(index));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: ItemTypes[widgetKey] === \"griddropped\" ? node => drag(drop(node)) : drag,\n    style: style,\n    children: [ItemTypes[widgetKey], index ? ` - ${index}` : null, indexInGrid !== null ? ` - ${indexInGrid}` : null, widgetKey === 'SIMPLEDROPPED' || widgetKey === \"GRIDDROPPED\" ? /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => handleRemove(index, indexInGrid),\n      children: \"x\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this) : null, indexInGrid === null && thisWidgetObj.children ? thisWidgetObj.children.map((dropped, iInGrid) => /*#__PURE__*/_jsxDEV(WidgetToDrag, {\n      index: index,\n      indexInGrid: iInGrid,\n      widgetKey: \"SIMPLEDROPPED\"\n    }, `grid-${index}-descendant-${iInGrid}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 57\n    }, this)) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 3\n  }, this);\n};\n_s(WidgetToDrag, \"9by4IbeTjO9JCjKoaYVyjyRoAIc=\", false, function () {\n  return [useSelector, useDispatch, useDrag, useDrop];\n});\n_c = WidgetToDrag;\nvar _c;\n$RefreshReg$(_c, \"WidgetToDrag\");","map":{"version":3,"names":["React","Children","useState","useDrag","useDrop","useSelector","useDispatch","ItemTypes","removeWidget","updateWidgetListOfDescendant","removeWidgetInGrid","jsxDEV","_jsxDEV","WidgetToDrag","widgetKey","index","indexInGrid","_s","listOfWidgets","state","value","dispatch","thisWidgetObj","type","clientOffset","x","y","sideBar","children","dragCollected","drag","item","itemType","addOrUpdatePos","collect","monitor","isDragging","previewOptions","backgroundColor","dropCollected","drop","accept","SIMPLEWIDGET","_item","console","log","handleDrop","getItem","isOver","bgColor","includes","style","padding","border","opacity","margin","width","position","top","left","obj","newDescendant","handleRemove","ref","node","onClick","fileName","_jsxFileName","lineNumber","columnNumber","map","dropped","iInGrid","_c","$RefreshReg$"],"sources":["/home/remi/REACT/nested-dnd/src/Widget.js"],"sourcesContent":["import React, {Children, useState} from \"react\";\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { removeWidget,\tupdateWidgetListOfDescendant, removeWidgetInGrid } from \"./widgetSlice\"\n\nexport const WidgetToDrag = ({ widgetKey, index, indexInGrid=null }) => {\n\n\tconst listOfWidgets = useSelector( (state) => state.listOfWidgets.value );\n\tconst dispatch = useDispatch();\n\n\tlet thisWidgetObj;\n\n\tif ( index === null){\n\t\t// comes from sidebar read it from props\n\t\tthisWidgetObj = { type: ItemTypes[widgetKey], clientOffset:{x:0, y:0}, sideBar: true }\n\t} else if (indexInGrid !== null) {\n\t\t// comes from pagelayout read it from the state\n\t\tthisWidgetObj = { ...listOfWidgets[index].children[indexInGrid], sideBar: false }\n\t} else {\n\t\tthisWidgetObj = { ...listOfWidgets[index], sideBar: false }\n\t}\n\n\tconst [ dragCollected, drag ] = useDrag( () => (\n\t\t{\n\t\t\ttype: thisWidgetObj.type,\n\t\t\titem: { itemType: thisWidgetObj.type, addOrUpdatePos: thisWidgetObj.sideBar ? \"add\" : index },\n\t\t\tcollect: (monitor) => ({\n\t\t\t\tisDragging: monitor.isDragging()\n\t\t\t}),\n\t\t\tpreviewOptions: {backgroundColor: \"red\"}\n\t\t}))\n\n\tconst [ dropCollected, drop  ] = useDrop( () => ({\n\t\taccept:[ItemTypes.SIMPLEWIDGET],\n\t\tdrop(_item, monitor) {\n\t\t\tconsole.log(\"drop\")\n\t\t\thandleDrop({\n\t\t\t\ttype: monitor.getItem().itemType,\n\t\t\t})\n\t\t},\n\t\tcollect: (monitor) => ({\n\t\t\tisOver: monitor.isOver()\n\t\t})\n\t}))\n\n\tlet bgColor;\n\tif (thisWidgetObj.type.includes(\"simple\")) {\n\t\tbgColor = \"grey\"\n\t} else if (thisWidgetObj.type === \"gridwidget\" ){\n\t\tbgColor = \"lightblue\"\n\t} else if (dropCollected.isOver){\n\t\tbgColor = \"red\"\n\t} else {\n\t\tbgColor = \"lightblue\"\n\t}\n\n\tconst style = {\n\t\tpadding: \"15px\",\n\t\tbackgroundColor: bgColor,\n\t\tborder: dragCollected.isDragging ? \"1px solid blue\" : \"1px solid red\",\n\t\topacity: dragCollected.isDragging ? \"0.5\" : \"1\",\n\t\tmargin: \"5px\",\n\t\twidth: \"fit-content\",\n\t\tposition: thisWidgetObj.sideBar || indexInGrid !== null ? \"relative\" : \"absolute\",\n\t\ttop: indexInGrid === null ? thisWidgetObj.clientOffset.y : \"0px\",\n\t\tleft: indexInGrid === null ? thisWidgetObj.clientOffset.x : \"0px\"\n\t}\n\n\tconst handleDrop = (obj) => {\n\t\tdispatch(updateWidgetListOfDescendant( {index, newDescendant: obj} ))\n\t};\n\n\tconst handleRemove = (index, indexInGrid) => {\n\t\tif ( indexInGrid !== null ){\n\t\t\tdispatch(removeWidgetInGrid( {index, indexInGrid} ))\n\t\t}\n\t\telse{\n\t\t\tdispatch(removeWidget(index))\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tref={\n\t\t\t\tItemTypes[widgetKey] === \"griddropped\"\n\t\t\t\t\t? (node) => drag(drop(node))\n\t\t\t\t\t: drag\n\t\t\t}\n\t\t\tstyle={style}\n\t\t>\n\t\t\t{ItemTypes[widgetKey]}\n\t\t\t{index ? ` - ${index}` : null}\n\t\t\t{indexInGrid !== null ? ` - ${indexInGrid}` : null}\n\t\t\t{widgetKey === 'SIMPLEDROPPED' || widgetKey === \"GRIDDROPPED\"\n\t\t\t\t? <button onClick={() => handleRemove( index, indexInGrid )}>x</button>\n\t\t\t\t\t: null }\n\t\t\t{ indexInGrid === null && thisWidgetObj.children\n\t\t\t\t? thisWidgetObj.children.map( (dropped, iInGrid) => <WidgetToDrag\n\t\t\t\t\tkey={`grid-${index}-descendant-${iInGrid}`}\n\t\t\t\t\tindex={index}\n\t\t\t\t\tindexInGrid={iInGrid}\n\t\t\t\t\twidgetKey=\"SIMPLEDROPPED\"\n\t\t\t\t\t/>)\n\t\t\t\t:null\n\t\t\t}\n\t\t</div>\n\t)\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}