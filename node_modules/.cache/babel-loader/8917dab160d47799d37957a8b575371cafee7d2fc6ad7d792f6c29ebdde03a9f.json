{"ast":null,"code":"var _jsxFileName = \"/home/remi/REACT/nested-dnd/src/PageLayout.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { WidgetToDrag } from \"./Widget\";\nimport { addWidget, removeWidget, updateWidgetPosition, updateWidgetListOfDescendant } from \"./widgetSlice\";\n\n/*\n\t\tTO DO:\n\t\tKeep coordinates inside drop zone for later.\n\t\thttps://github.com/react-dnd/react-dnd/issues/151#issuecomment-1345021282\n*/\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function PageLayout() {\n  _s();\n  const boundingBox = useRef(null);\n  const listOfWidgets = useSelector(state => state.listOfWidgets.value);\n  const dispatch = useDispatch();\n  const [listOfDropped, setListOfDropped] = useState([]);\n  const [collected, dropRef] = useDrop(() => ({\n    accept: Object.keys(ItemTypes).map(key => ItemTypes[key]),\n    drop(_item, monitor) {\n      if (monitor.isOver({\n        shallow: true\n      })) {\n        const initialClientOffset = monitor.getInitialClientOffset();\n        const initialSourceClientOffset = monitor.getInitialSourceClientOffset();\n        /*\n        \t\tInitialOffset is the position of the click relative to the source widget\n        */\n        const initialOffsetX = initialClientOffset.x - initialSourceClientOffset.x;\n        const initialOffsetY = initialClientOffset.y - initialSourceClientOffset.y;\n\n        /*\n        \t\tOffset is the position where the widget has been dropped inside the web page (client)\n        */\n        const offset = monitor.getClientOffset();\n\n        /*\n        \t\tCalculates where the widget has been droped inside the pageLayout( boundingBox )\n        */\n        const deltaX = offset.x - boundingBox.current.x - initialOffsetX;\n        const deltaY = offset.y - boundingBox.current.y - initialOffsetY;\n        handleDrop({\n          type: monitor.getItem().itemType,\n          clientOffset: {\n            x: deltaX,\n            y: deltaY\n          },\n          addOrUpdatePos: monitor.getItem().addOrUpdatePos\n        });\n      }\n    },\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n      isOverCurrent: monitor.isOver({\n        shallow: true\n      }),\n      itemType: monitor.getItemType(),\n      item: monitor.getItem(),\n      dropped: monitor.didDrop(),\n      dropResult: monitor.getDropResult()\n    })\n  }));\n  function combineRef(el) {\n    dropRef(el);\n    if (el) {\n      boundingBox.current = el.getBoundingClientRect();\n    }\n  }\n  const handleDrop = dropped => {\n    console.log(\"---- in pageLayout handledrop\");\n    const newDropped = {\n      ...dropped\n    };\n    switch (dropped.type) {\n      case 'simplewidget':\n        newDropped.type = \"simpledropped\";\n        break;\n      case 'gridwidget':\n        newDropped.type = \"griddropped\";\n        break;\n    }\n    newDropped.children = [];\n    if (newDropped.addOrUpdatePos === \"add\") {\n      dispatch(addWidget(newDropped));\n    } else if (typeof newDropped.addOrUpdatePos === \"number\") {\n      dispatch(updateWidgetPosition(newDropped));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"pageLayoutDiv\",\n    ref: combineRef,\n    style: {\n      width: \"500px\",\n      height: \"500px\",\n      backgroundColor: collected.isOverCurrent ? \"lightgreen\" : \"lightcyan\",\n      marginLeft: \"20px\",\n      padding: \"10px\",\n      position: \"relative\",\n      float: \"left\"\n    },\n    children: listOfWidgets ? listOfWidgets.map((dropped, i) => {\n      let newWidgetType;\n      switch (dropped.type) {\n        case 'simpledropped':\n          newWidgetType = \"SIMPLEDROPPED\";\n          break;\n        case 'griddropped':\n          newWidgetType = \"GRIDDROPPED\";\n          break;\n      }\n      return /*#__PURE__*/_jsxDEV(WidgetToDrag, {\n        widgetKey: newWidgetType,\n        index: i,\n        clientOffset: dropped.clientOffset\n      }, `pageLayout-widget-${i}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 7\n      }, this);\n    }) : null\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 3\n  }, this);\n}\n_s(PageLayout, \"SKhmUdrQ/w5KC5lYAkgpJioVhZ8=\", false, function () {\n  return [useSelector, useDispatch, useDrop];\n});\n_c = PageLayout;\nvar _c;\n$RefreshReg$(_c, \"PageLayout\");","map":{"version":3,"names":["React","useState","useRef","useDrop","useSelector","useDispatch","ItemTypes","WidgetToDrag","addWidget","removeWidget","updateWidgetPosition","updateWidgetListOfDescendant","jsxDEV","_jsxDEV","PageLayout","_s","boundingBox","listOfWidgets","state","value","dispatch","listOfDropped","setListOfDropped","collected","dropRef","accept","Object","keys","map","key","drop","_item","monitor","isOver","shallow","initialClientOffset","getInitialClientOffset","initialSourceClientOffset","getInitialSourceClientOffset","initialOffsetX","x","initialOffsetY","y","offset","getClientOffset","deltaX","current","deltaY","handleDrop","type","getItem","itemType","clientOffset","addOrUpdatePos","collect","isOverCurrent","getItemType","item","dropped","didDrop","dropResult","getDropResult","combineRef","el","getBoundingClientRect","console","log","newDropped","children","id","ref","style","width","height","backgroundColor","marginLeft","padding","position","float","i","newWidgetType","widgetKey","index","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/remi/REACT/nested-dnd/src/PageLayout.js"],"sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { WidgetToDrag } from \"./Widget\";\nimport { addWidget, removeWidget, updateWidgetPosition,\n\t\t\t\t updateWidgetListOfDescendant } from \"./widgetSlice\"\n\n\n/*\n\t\tTO DO:\n\t\tKeep coordinates inside drop zone for later.\n\t\thttps://github.com/react-dnd/react-dnd/issues/151#issuecomment-1345021282\n*/\n\n\nexport function PageLayout(){\n\n\tconst boundingBox = useRef( null );\n\n\tconst listOfWidgets = useSelector((state) => state.listOfWidgets.value )\n\tconst dispatch = useDispatch();\n\n\tconst [listOfDropped, setListOfDropped] = useState([])\n\n\tconst [collected, dropRef] = useDrop(() => ({\n\t\taccept: Object.keys(ItemTypes).map(key => (ItemTypes[key])),\n\t\tdrop(_item, monitor) {\n\t\t\tif ( monitor.isOver({shallow: true}) ){\n\n\t\t\t\tconst initialClientOffset = monitor.getInitialClientOffset();\n\t\t\t\tconst initialSourceClientOffset = monitor.getInitialSourceClientOffset();\n\t\t\t\t/*\n\t\t\t\t\t\tInitialOffset is the position of the click relative to the source widget\n\t\t\t\t*/\n\t\t\t\tconst initialOffsetX = initialClientOffset.x - initialSourceClientOffset.x\n\t\t\t\tconst initialOffsetY = initialClientOffset.y - initialSourceClientOffset.y\n\n\t\t\t\t/*\n\t\t\t\t\t\tOffset is the position where the widget has been dropped inside the web page (client)\n\t\t\t\t*/\n\t\t\t\tconst offset = monitor.getClientOffset();\n\n\t\t\t\t/*\n\t\t\t\t\t\tCalculates where the widget has been droped inside the pageLayout( boundingBox )\n\t\t\t\t*/\n\t\t\t\tconst deltaX = offset.x - boundingBox.current.x - initialOffsetX;\n\t\t\t\tconst deltaY = offset.y - boundingBox.current.y - initialOffsetY;\n\n\t\t\t\thandleDrop( {\n\t\t\t\t\ttype: monitor.getItem().itemType,\n\t\t\t\t\tclientOffset: { x: deltaX, y: deltaY },\n\t\t\t\t\taddOrUpdatePos: monitor.getItem().addOrUpdatePos\n\t\t\t\t} )}\n\t\t},\n\t\tcollect: (monitor) => ({\n\t\t\tisOver: monitor.isOver(),\n\t\t\tisOverCurrent: monitor.isOver( {shallow: true} ),\n\t\t\titemType: monitor.getItemType(),\n\t\t\titem: monitor.getItem(),\n\t\t\tdropped: monitor.didDrop(),\n\t\t\tdropResult: monitor.getDropResult(),\n\t\t})\n\t}))\n\n\tfunction combineRef(el){\n\t\tdropRef( el );\n\t\tif (el){\n\t\t\tboundingBox.current = el.getBoundingClientRect()\n\t\t}\n\t}\n\n\tconst handleDrop = ( dropped ) => {\n\t\tconsole.log(\"---- in pageLayout handledrop\")\n\n\t\tconst newDropped = {...dropped}\n\n\t\tswitch (dropped.type) {\n\t\t\tcase 'simplewidget':\n\t\t\t\tnewDropped.type = \"simpledropped\"\n\t\t\t\tbreak;\n\t\t\tcase 'gridwidget':\n\t\t\t\tnewDropped.type = \"griddropped\"\n\t\t\t\tbreak;\n\t\t\t}\n\t\tnewDropped.children = []\n\t\tif (newDropped.addOrUpdatePos === \"add\" ){\n\t\t\tdispatch(addWidget( newDropped ))\n\t\t} else if ( typeof newDropped.addOrUpdatePos === \"number\"){\n\t\t\tdispatch(updateWidgetPosition( newDropped ))\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tid=\"pageLayoutDiv\"\n\t\t\tref={combineRef}\n\t\t\tstyle={{\n\t\t\t\twidth: \"500px\",\n\t\t\t\theight: \"500px\",\n\t\t\t\tbackgroundColor: collected.isOverCurrent ? \"lightgreen\" :\"lightcyan\",\n\t\t\t\tmarginLeft: \"20px\",\n\t\t\t\tpadding: \"10px\",\n\t\t\t\tposition: \"relative\",\n\t\t\t\tfloat: \"left\"\n\t\t}}>\n\t\t\t{listOfWidgets ?\n\t\t\t\tlistOfWidgets.map( (dropped, i ) => {\n\n\t\t\t\t\tlet newWidgetType;\n\t\t\t\t\tswitch( dropped.type ){\n\t\t\t\t\t\tcase 'simpledropped': newWidgetType = \"SIMPLEDROPPED\"\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'griddropped': newWidgetType = \"GRIDDROPPED\"\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<WidgetToDrag\n\t\t\t\t\t\t\twidgetKey={newWidgetType}\n\t\t\t\t\t\t\tkey={`pageLayout-widget-${i}`}\n\t\t\t\t\t\t\tindex={i}\n\t\t\t\t\t\t\tclientOffset={dropped.clientOffset}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t)})\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t</div>\n\t)\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}