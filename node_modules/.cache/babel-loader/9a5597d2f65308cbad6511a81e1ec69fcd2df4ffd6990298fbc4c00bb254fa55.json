{"ast":null,"code":"var _jsxFileName = \"/home/remi/REACT/nested-dnd/src/PageLayout.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { WidgetToDrag } from \"./Widget\";\nimport { addWidget, updateWidgetPosition } from \"./widgetSlice\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function PageLayout() {\n  _s();\n  const boundingBox = useRef(null);\n  const listOfWidgets = useSelector(state => state.listOfWidgets.value);\n  const dispatch = useDispatch();\n  const [listOfDropped, setListOfDropped] = useState([]);\n  const [collected, dropRef] = useDrop(() => ({\n    accept: Object.keys(ItemTypes).map(key => ItemTypes[key]),\n    drop(_item, monitor) {\n      if (monitor.isOver({\n        shallow: true\n      })) {\n        const initialClientOffset = monitor.getInitialClientOffset();\n        const initialSourceClientOffset = monitor.getInitialSourceClientOffset();\n        /*\n        \t\tInitialOffset is the position of the click relative to the source widget\n        */\n        const initialOffsetX = initialClientOffset.x - initialSourceClientOffset.x;\n        const initialOffsetY = initialClientOffset.y - initialSourceClientOffset.y;\n\n        /*\n        \t\tOffset is the position where the widget has been dropped inside the web page (client)\n        */\n        const offset = monitor.getClientOffset();\n\n        /*\n        \t\tCalculates where the widget has been droped inside the pageLayout( boundingBox )\n        */\n        const deltaX = offset.x - boundingBox.current.x - initialOffsetX;\n        const deltaY = offset.y - boundingBox.current.y - initialOffsetY;\n        handleDrop({\n          type: monitor.getItem().itemType,\n          clientOffset: {\n            x: deltaX,\n            y: deltaY\n          },\n          addOrUpdatePos: monitor.getItem().addOrUpdatePos\n        });\n      }\n    },\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n      isOverCurrent: monitor.isOver({\n        shallow: true\n      }),\n      itemType: monitor.getItemType(),\n      item: monitor.getItem(),\n      dropped: monitor.didDrop(),\n      dropResult: monitor.getDropResult()\n    })\n  }));\n  function combineRef(el) {\n    dropRef(el);\n    if (el) {\n      boundingBox.current = el.getBoundingClientRect();\n    }\n  }\n  const handleDrop = dropped => {\n    console.log(\"---- in pageLayout handledrop\");\n    const newDropped = {\n      ...dropped\n    };\n    switch (dropped.type) {\n      case 'simplewidget':\n        newDropped.type = \"simpledropped\";\n        break;\n      case 'gridwidget':\n        newDropped.type = \"griddropped\";\n        break;\n    }\n    newDropped.children = [];\n    if (newDropped.addOrUpdatePos === \"add\") {\n      dispatch(addWidget(newDropped));\n      addWidgetToState(newDropped);\n    } else if (typeof newDropped.addOrUpdatePos === \"number\") {\n      dispatch(updateWidgetPosition(newDropped));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"pageLayoutDiv\",\n    ref: combineRef,\n    style: {\n      width: \"500px\",\n      height: \"500px\",\n      backgroundColor: collected.isOverCurrent ? \"lightgreen\" : \"lightcyan\",\n      marginLeft: \"20px\",\n      padding: \"10px\",\n      position: \"relative\",\n      float: \"left\"\n    },\n    children: listOfWidgets ? listOfWidgets.map((dropped, i) => {\n      let newWidgetType;\n      switch (dropped.type) {\n        case 'simpledropped':\n          newWidgetType = \"SIMPLEDROPPED\";\n          break;\n        case 'griddropped':\n          newWidgetType = \"GRIDDROPPED\";\n          break;\n      }\n      return /*#__PURE__*/_jsxDEV(WidgetToDrag, {\n        widgetKey: newWidgetType,\n        index: i,\n        clientOffset: dropped.clientOffset\n      }, `pageLayout-widget-${i}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }, this);\n    }) : null\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 3\n  }, this);\n}\n_s(PageLayout, \"SKhmUdrQ/w5KC5lYAkgpJioVhZ8=\", false, function () {\n  return [useSelector, useDispatch, useDrop];\n});\n_c = PageLayout;\nconst addWidgetToState = (state, action) => {\n  console.log(\"-- in addWidgetToState\");\n  console.log(action.payload);\n  const newState = [...state.value];\n  console.log(newState);\n  newState.push(action.payload);\n  state.value = newState;\n};\nvar _c;\n$RefreshReg$(_c, \"PageLayout\");","map":{"version":3,"names":["React","useState","useRef","useDrop","useSelector","useDispatch","ItemTypes","WidgetToDrag","addWidget","updateWidgetPosition","jsxDEV","_jsxDEV","PageLayout","_s","boundingBox","listOfWidgets","state","value","dispatch","listOfDropped","setListOfDropped","collected","dropRef","accept","Object","keys","map","key","drop","_item","monitor","isOver","shallow","initialClientOffset","getInitialClientOffset","initialSourceClientOffset","getInitialSourceClientOffset","initialOffsetX","x","initialOffsetY","y","offset","getClientOffset","deltaX","current","deltaY","handleDrop","type","getItem","itemType","clientOffset","addOrUpdatePos","collect","isOverCurrent","getItemType","item","dropped","didDrop","dropResult","getDropResult","combineRef","el","getBoundingClientRect","console","log","newDropped","children","addWidgetToState","id","ref","style","width","height","backgroundColor","marginLeft","padding","position","float","i","newWidgetType","widgetKey","index","fileName","_jsxFileName","lineNumber","columnNumber","_c","action","payload","newState","push","$RefreshReg$"],"sources":["/home/remi/REACT/nested-dnd/src/PageLayout.js"],"sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { ItemTypes } from \"./ItemTypes\";\nimport { WidgetToDrag } from \"./Widget\";\nimport { addWidget, updateWidgetPosition } from \"./widgetSlice\"\n\n\n\nexport function PageLayout() {\n\n\tconst boundingBox = useRef(null);\n\n\tconst listOfWidgets = useSelector((state) => state.listOfWidgets.value)\n\tconst dispatch = useDispatch();\n\n\tconst [listOfDropped, setListOfDropped] = useState([]);\n\n\tconst [collected, dropRef] = useDrop(() => ({\n\t\taccept: Object.keys(ItemTypes).map(key => (ItemTypes[key])),\n\t\tdrop(_item, monitor) {\n\t\t\tif (monitor.isOver({ shallow: true })) {\n\n\t\t\t\tconst initialClientOffset = monitor.getInitialClientOffset();\n\t\t\t\tconst initialSourceClientOffset = monitor.getInitialSourceClientOffset();\n\t\t\t\t/*\n\t\t\t\t\t\tInitialOffset is the position of the click relative to the source widget\n\t\t\t\t*/\n\t\t\t\tconst initialOffsetX = initialClientOffset.x - initialSourceClientOffset.x\n\t\t\t\tconst initialOffsetY = initialClientOffset.y - initialSourceClientOffset.y\n\n\t\t\t\t/*\n\t\t\t\t\t\tOffset is the position where the widget has been dropped inside the web page (client)\n\t\t\t\t*/\n\t\t\t\tconst offset = monitor.getClientOffset();\n\n\t\t\t\t/*\n\t\t\t\t\t\tCalculates where the widget has been droped inside the pageLayout( boundingBox )\n\t\t\t\t*/\n\t\t\t\tconst deltaX = offset.x - boundingBox.current.x - initialOffsetX;\n\t\t\t\tconst deltaY = offset.y - boundingBox.current.y - initialOffsetY;\n\n\t\t\t\thandleDrop({\n\t\t\t\t\ttype: monitor.getItem().itemType,\n\t\t\t\t\tclientOffset: { x: deltaX, y: deltaY },\n\t\t\t\t\taddOrUpdatePos: monitor.getItem().addOrUpdatePos\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tcollect: (monitor) => ({\n\t\t\tisOver: monitor.isOver(),\n\t\t\tisOverCurrent: monitor.isOver({ shallow: true }),\n\t\t\titemType: monitor.getItemType(),\n\t\t\titem: monitor.getItem(),\n\t\t\tdropped: monitor.didDrop(),\n\t\t\tdropResult: monitor.getDropResult(),\n\t\t})\n\t}))\n\n\tfunction combineRef(el) {\n\t\tdropRef(el);\n\t\tif (el) {\n\t\t\tboundingBox.current = el.getBoundingClientRect()\n\t\t}\n\t}\n\n\tconst handleDrop = (dropped) => {\n\t\tconsole.log(\"---- in pageLayout handledrop\")\n\n\t\tconst newDropped = { ...dropped }\n\n\t\tswitch (dropped.type) {\n\t\t\tcase 'simplewidget':\n\t\t\t\tnewDropped.type = \"simpledropped\"\n\t\t\t\tbreak;\n\t\t\tcase 'gridwidget':\n\t\t\t\tnewDropped.type = \"griddropped\"\n\t\t\t\tbreak;\n\t\t}\n\t\tnewDropped.children = []\n\t\tif (newDropped.addOrUpdatePos === \"add\") {\n\t\t\tdispatch(addWidget(newDropped));\n\t\t\taddWidgetToState(newDropped)\n\t\t} else if (typeof newDropped.addOrUpdatePos === \"number\") {\n\t\t\tdispatch(updateWidgetPosition(newDropped))\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tid=\"pageLayoutDiv\"\n\t\t\tref={combineRef}\n\t\t\tstyle={{\n\t\t\t\twidth: \"500px\",\n\t\t\t\theight: \"500px\",\n\t\t\t\tbackgroundColor: collected.isOverCurrent ? \"lightgreen\" : \"lightcyan\",\n\t\t\t\tmarginLeft: \"20px\",\n\t\t\t\tpadding: \"10px\",\n\t\t\t\tposition: \"relative\",\n\t\t\t\tfloat: \"left\"\n\t\t\t}}>\n\t\t\t{listOfWidgets ?\n\t\t\t\tlistOfWidgets.map((dropped, i) => {\n\n\t\t\t\t\tlet newWidgetType;\n\t\t\t\t\tswitch (dropped.type) {\n\t\t\t\t\t\tcase 'simpledropped': newWidgetType = \"SIMPLEDROPPED\"\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'griddropped': newWidgetType = \"GRIDDROPPED\"\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<WidgetToDrag\n\t\t\t\t\t\t\twidgetKey={newWidgetType}\n\t\t\t\t\t\t\tkey={`pageLayout-widget-${i}`}\n\t\t\t\t\t\t\tindex={i}\n\t\t\t\t\t\t\tclientOffset={dropped.clientOffset}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t: null\n\t\t\t}\n\t\t</div>\n\t)\n}\n\nconst addWidgetToState = (state, action) => {\n\tconsole.log(\"-- in addWidgetToState\")\n\tconsole.log(action.payload)\n\tconst newState = [...state.value];\n\tconsole.log(newState)\n\tnewState.push(action.payload);\n\tstate.value = newState\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}